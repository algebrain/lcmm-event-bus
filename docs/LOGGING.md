# Логирование и Наблюдаемость (Observability)

Этот документ описывает стандартный подход к логированию в системе, нацеленный на обеспечение наблюдаемости, упрощение отладки и анализа поведения компонентов. Ключевым принципом является использование структурированных логов в формате карт.
Имплементация шины событий доступна в [GitHub-репозитории](https://github.com/algebrain/lcmm-event-bus).

## 1. Стандартный Интерфейс Логгера

Логгер в системе представляет собой функцию, которая принимает два аргумента:
1.  `level` — уровень логирования (ключевое слово, например, `:info`, `:warn`, `:error`, `:debug`, `:trace`).
2.  `data` — **карта** с данными о событии, предоставляющая контекст.

### Пример реализации логгера
Вы можете реализовать логгер, который обертывает любую библиотеку логирования, например `clojure.tools.logging`:

```clojure
(require '[clojure.tools.logging :as log])

(defn make-app-logger []
  (fn [level data]
    (case level
      :info  (log/info data)
      :warn  (log/warn data)
      :error (log/error data)
      :debug (log/debug data)
      :trace (log/trace data)
      (log/info data))))) ; Дефолтный уровень
```

## 2. Интеграция Логгера в Компоненты

Каждый компонент или модуль системы, требующий логирования, должен принимать экземпляр этой функции-логгера в качестве зависимости.

Например:
*   **`event-bus`**: При создании экземпляра шины через `bus/make-bus` функция-логгер передается через опцию `:logger`.
*   **Модули**: Функция `init!` каждого модуля (см. `MODULE.md`) будет принимать логгер как одну из своих зависимостей, что позволит модулю логировать свои внутренние события.

## 3. Структура Лог-Сообщений

Все сообщения, передаваемые логгеру в аргументе `data`, **должны быть картами**. Это обеспечивает структурированность логов, упрощает их поиск, фильтрацию и анализ в системах агрегации логов.

Рекомендуемые поля для всех лог-сообщений:
*   `:component` (обязательно): Ключевое слово, идентифицирующее компонент, который сгенерировал лог (например, `:event-bus`, `:my-module`, `:user-service`).
*   `:event` (обязательно): Ключевое слово, кратко описывающее тип произошедшего события (например, `:event-published`, `:user-created`, `:http-request-received`).
*   Дополнительные поля: Любые другие данные, которые помогают понять контекст события (например, `correlation-id`, `user-id`, `path`, `exception`, `payload`).
