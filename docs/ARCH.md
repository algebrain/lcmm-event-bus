# Архитектура: Слабо связанный модульный монолит

Этот документ определяет архитектурный стиль системы, построенной на основе `event-bus`.

## 1. Разделение Ответственности (CQRS-like)

Система делится на два логических потока:

- **Критический Путь (Synchronous):**
  - Ответственен за выполнение ключевых бизнес-транзакций, которые должны быть атомарными и быстрыми (например, создание заказа в БД).
  - Этот путь **не должен** содержать медленных операций (HTTP-запросы, отправка email, сложная обработка данных).
  - В случае успеха, он публикует в шину событие о результате (например, `:order/created`).

- **Реактивный Путь (Asynchronous):**
  - Представлен обработчиками событий, подписанными на шину.
  - Выполняет все "побочные эффекты": отправку уведомлений, логирование, обновление поисковых индексов, вызов внешних систем.
  - Работает асинхронно и не блокирует критический путь. Ошибка в одном из обработчиков не влияет на другие и на основную транзакцию.

## 2. Слабая Связанность (Loose Coupling)

- Модули системы **никогда** не вызывают функции друг друга напрямую.
- Единственный способ коммуникации — через асинхронные, иммутабельные сообщения (`конверты`) в `event-bus`.
- Модуль А не знает о существовании Модуля Б. Он просто публикует событие `:event-from-a`, а Модуль Б на него реагирует. Это позволяет добавлять, удалять или изменять модули, не затрагивая остальную систему.

## 3. Контроль и Наблюдаемость (Causality & Observability)

- **Причинно-следственная связь:** Шина отслеживает, какое событие породило какое, с помощью `CausationPath` (упорядоченный путь пар `(Module, MessageType)`) и `CorrelationID`. Это позволяет:
  - Легко отследить всю цепочку вызовов, приведшую к ошибке.
  - Автоматически предотвращать циклы событий на уровне пары `(Module, MessageType)`.
- **Прозрачность:** Каждое событие может быть залогировано, что дает полную картину происходящего в системе.
